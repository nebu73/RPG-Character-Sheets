<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Personajes - Candela Obscura</title>
  <link rel="icon" type="image/png" href="https://www.ulisses-ebooks.de/images/23533/_product_images/438694/candela_obscura_logo_stacked_gold.png">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=IM+Fell+English:ital@0;1&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'IM Fell English', serif;
      background-color: #0a0a08;
      background-image: 
        url('https://www.transparenttextures.com/patterns/black-paper.png'),
        radial-gradient(circle at center, #2a1a0f 0%, #0a0806 100%);
      color: #e0d4b3;
      letter-spacing: 0.5px;
      line-height: 1.6;
    }
    .card {
      background-color: rgba(10, 8, 6, 0.85);
      border: 1px solid #5d4a2e;
      border-radius: 0;
      border-left: 4px solid #8c6a3a;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: url('https://www.transparenttextures.com/patterns/aged-paper.png');
      opacity: 0.15;
      pointer-events: none;
    }
    input, textarea, select {
      font-family: 'IM Fell English', serif;
      color: #e0d4b3;
      background-color: rgba(30, 25, 18, 0.7);
      border: 1px solid #5d4a2e;
      padding: 0.5rem;
      width: 100%;
      transition: all 0.3s ease;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #8c6a3a;
      box-shadow: 0 0 0 2px rgba(140, 106, 58, 0.3);
      background-color: rgba(40, 35, 28, 0.7);
    }
    .logo {
      max-width: 350px;
      margin: 0 auto 2rem;
      display: block;
      filter: drop-shadow(0 0 8px rgba(140, 106, 58, 0.5));
    }
    h1, h2, h3, h4 {
      font-family: 'Cinzel Decorative', serif;
      color: #c9a769;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
      letter-spacing: 1px;
    }
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      text-transform: uppercase;
      border-bottom: 2px solid #8c6a3a;
      padding-bottom: 0.5rem;
      margin-bottom: 1.5rem;
      position: relative;
    }
    h1::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #8c6a3a, transparent);
    }
    h2 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      position: relative;
      display: inline-block;
    }
    h2::after {
      content: "";
      position: absolute;
      bottom: -3px;
      left: 0;
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, transparent, #8c6a3a, transparent);
    }
    .list-disc li::marker {
      color: #8c6a3a;
      font-size: 1.2em;
    }
    .preview-label {
      font-family: 'Cinzel Decorative', serif;
      color: #c9a769;
      font-weight: bold;
      display: inline-block;
      min-width: 120px;
    }
    .hidden { display: none; }
    button, .btn {
      font-family: 'Cinzel Decorative', serif;
      background: linear-gradient(to bottom, #8c6a3a, #5d4a2e);
      color: #f0e6d2;
      border: 1px solid #3a2e1f;
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    button:hover, .btn:hover {
      background: linear-gradient(to bottom, #9d7a4a, #6d5a3e);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
      transform: translateY(-1px);
    }
    button:active, .btn:active {
      transform: translateY(1px);
    }
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23c9a769'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1.5rem;
      padding-right: 2rem;
    }
    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .checkbox-container input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 1px solid #5d4a2e;
      background-color: rgba(30, 25, 18, 0.7);
      margin-right: 0.5rem;
      position: relative;
      cursor: pointer;
    }
    .checkbox-container input[type="checkbox"]:checked {
      background-color: #8c6a3a;
    }
    .checkbox-container input[type="checkbox"]:checked::after {
      content: "‚úì";
      position: absolute;
      color: #f0e6d2;
      font-size: 14px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .ornament {
      position: absolute;
      opacity: 0.1;
      pointer-events: none;
    }
    .ornament-1 {
      top: 20px;
      right: 20px;
      font-family: 'UnifrakturMaguntia', cursive;
      font-size: 3rem;
      transform: rotate(15deg);
    }
    .ornament-2 {
      bottom: 20px;
      left: 20px;
      font-family: 'UnifrakturMaguntia', cursive;
      font-size: 3rem;
      transform: rotate(-15deg);
    }
    .scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .scrollbar::-webkit-scrollbar-track {
      background: rgba(30, 25, 18, 0.5);
    }
    .scrollbar::-webkit-scrollbar-thumb {
      background-color: #5d4a2e;
      border-radius: 4px;
    }
    .character-image-container {
      position: relative;
      width: 200px;
      height: 250px;
      margin: 0 auto 1.5rem;
      border: 3px solid #5d4a2e;
      background-color: rgba(20, 15, 10, 0.7);
      box-shadow: 0 0 15px rgba(140, 106, 58, 0.3);
      overflow: hidden;
    }
    .character-image-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://www.transparenttextures.com/patterns/brushed-alum-dark.png');
      opacity: 0.3;
      pointer-events: none;
    }
    .character-image-container::after {
      content: "";
      position: absolute;
      top: 5px;
      left: 5px;
      right: 5px;
      bottom: 5px;
      border: 1px solid rgba(140, 106, 58, 0.5);
      pointer-events: none;
    }
    #character-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }
    .image-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #8c6a3a;
      font-family: 'IM Fell English', serif;
      font-size: 0.9rem;
    }
    .image-placeholder svg {
      width: 50px;
      height: 50px;
      margin-bottom: 1rem;
      fill: #5d4a2e;
    }
    .image-upload-btn {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      padding: 0.3rem 0.8rem;
    }
    .abilities-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }
    .abilities-list ul {
      list-style-type: none;
      padding-left: 0;
    }
    .abilities-list li {
      margin-bottom: 0.8rem;
      padding-left: 1rem;
      position: relative;
    }
    .abilities-list li::before {
      content: "‚Ä¢";
      position: absolute;
      left: 0;
      color: #8c6a3a;
      font-size: 1.5rem;
      line-height: 1;
    }
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      .logo {
        max-width: 250px;
      }
      .character-image-container {
        width: 150px;
        height: 200px;
      }
    }
  </style>
</head>
<body class="p-4 md:p-6">
</div>
  <div class="max-w-4xl mx-auto relative">
 
    
    <img src="https://www.ulisses-ebooks.de/images/23533/_product_images/438694/candela_obscura_logo_stacked_gold.png" alt="Candela Obscura Logo" class="logo">
    <h1 class="text-center">Generador de Personajes</h1>

    <form onsubmit="return validarFormulario(event)">
      <div class="card">
        <h2>Informaci√≥n del Personaje</h2>
        
        <div class="character-image-container">
          <img id="character-image" alt="Imagen del personaje">
          <div class="image-placeholder" id="image-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M19 13l-6 6-6-6h12zM7 11l6-6 6 6H7z"/>
            </svg>
            Imagen del Personaje
            <button type="button" class="btn image-upload-btn" onclick="document.getElementById('image-upload').click()">Subir Imagen</button>
            <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="nombre" class="block mb-1">Nombre:<span class="text-red-400 ml-1">*</span></label>
            <input type="text" id="nombre" class="rounded-sm" required oninput="updatePreview()">
          </div>
          <div>
            <label for="circulo" class="block mb-1">C√≠rculo:<span class="text-red-400 ml-1">*</span></label>
            <input type="text" id="circulo" class="rounded-sm" required oninput="updatePreview()">
          </div>
          <div>
            <label for="estilo" class="block mb-1">Estilo:<span class="text-red-400 ml-1">*</span></label>
            <input type="text" id="estilo" class="rounded-sm" required oninput="updatePreview()">
          </div>
        </div>
        <div class="mt-4">
          <label for="catalizador" class="block mb-1">Catalizador:<span class="text-red-400 ml-1">*</span></label>
          <textarea id="catalizador" class="rounded-sm" rows="2" required oninput="updatePreview()"></textarea>
        </div>
        <div class="mt-4">
          <label for="cuestion" class="block mb-1">Cuesti√≥n:<span class="text-red-400 ml-1">*</span></label>
          <textarea id="cuestion" class="rounded-sm" rows="2" required oninput="updatePreview()"></textarea>
        </div>
        <div class="mt-4">
          <label for="rol" class="block mb-1">Rol:<span class="text-red-400 ml-1">*</span></label>
          <select id="rol" name="rol" class="rounded-sm" onchange="mostrarDetallesRol(); updatePreview();">
            <option value="">Seleccionar</option>
            <option value="cara">CARA</option>
            <option value="musculo">M√öSCULO</option>
            <option value="erudito">ERUDITO</option>
            <option value="escurridizo">ESCURRIDIZO</option>
            <option value="raro">RARO</option>
          </select>
        </div>
      </div>

      <div id="detalle-rol" class="card hidden">
        <h2>Detalles del Rol</h2>
        <div id="contenido-clases" class="scrollbar" style="max-height: 500px; overflow-y: auto;"></div>
      </div>

      <div class="card">
        <h2>Equipamiento (m√°ximo 6)</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2" id="equipamiento"></div>
      </div>

      <div class="card">
        <h2>Vista Previa de la Ficha</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="md:col-span-1">
            <div class="character-image-container">
              <img id="preview-character-image" alt="Imagen del personaje" style="display: none;">
              <div class="image-placeholder" id="preview-image-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M19 13l-6 6-6-6h12zM7 11l6-6 6 6H7z"/>
                </svg>
                Imagen del Personaje
              </div>
            </div>
          </div>
          <div class="md:col-span-2">
            <div class="space-y-2">
              <p><span class="preview-label">Nombre:</span> <span id="preview-nombre" class="italic"></span></p>
              <p><span class="preview-label">C√≠rculo:</span> <span id="preview-circulo" class="italic"></span></p>
              <p><span class="preview-label">Estilo:</span> <span id="preview-estilo" class="italic"></span></p>
              <p><span class="preview-label">Rol:</span> <span id="preview-rol" class="italic"></span></p>
              <p><span class="preview-label">Subclase:</span> <span id="preview-subclase" class="italic"></span></p>
              <p><span class="preview-label">Catalizador:</span> <span id="preview-catalizador" class="italic"></span></p>
              <p><span class="preview-label">Cuesti√≥n:</span> <span id="preview-cuestion" class="italic"></span></p>
              <p><span class="preview-label">Equipamiento:</span> <span id="preview-equipamiento" class="italic"></span></p>
            </div>
          </div>
        </div>
        
        <div class="mt-6">
          <h3 class="text-lg text-amber-200 mb-2">Habilidades</h3>
          <div id="preview-habilidades" class="abilities-list scrollbar">
            <p class="italic text-gray-400">Selecciona un rol para ver las habilidades</p>
          </div>
        </div>
      </div>
      
      <div class="flex justify-center mt-6 mb-10">
        <button type="submit" class="btn">
          Generar Ficha Completa
        </button>

      </div>
     <div class="flex justify-center my-4">
        <button onclick="openDiceModal()" class="btn">
         üé≤ Lanzar Dados
        </button>
    </form>
  </div>

	<!-- MODAL de Lanzador de Dados -->
<div id="diceModal" class="fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center hidden">
  <div class="bg-[#0a0a08] border border-[#8c6a3a] shadow-2xl rounded-lg p-6 max-w-lg w-full relative text-[#e0d4b3] font-serif">
    <button onclick="closeDiceModal()" class="absolute top-2 right-2 text-[#c9a769] text-xl font-bold hover:text-red-500 transition">&times;</button>
    <h2 class="text-2xl font-bold mb-4 text-center text-[#c9a769] font-decorative">Lanzador de Dados</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="greenDice" class="block font-semibold mb-1">Dados Normalesüü¢</label>
        <input type="number" id="greenDice" min="0" value="2" class="rounded-sm w-full">
      </div>
      <div>
        <label for="goldDice" class="block font-semibold mb-1">Dados Guilded ‚ú®</label>
        <input type="number" id="goldDice" min="0" value="1" class="rounded-sm w-full">
      </div>
    </div>

    <button onclick="rollCandelaDice()" class="btn mt-4 w-full">Lanzar</button>

    <div id="dice-results" class="mt-4 text-lg space-y-2"></div>
    <div id="dice-final" class="mt-2 font-bold text-xl"></div>
  </div>
</div>
<audio id="dice-sound" preload="auto">
  <source src="https://cdn.freesound.org/previews/86/86727_1022651-lq.mp3" type="audio/mpeg">
</audio>
  <script>
    // Datos de clases y subclases
    const clases = {
      cara: {
        nombre: "CARA",
        habilidades: [
          "<strong>Conozco a un tipo:</strong> Una vez por misi√≥n, pregunta al GM a qui√©n conoces cerca que pueda ayudarte con informaci√≥n, acceso o recursos.",
          "<strong>Engatusar:</strong> Sabes c√≥mo trabajar en la sala. Cuando intentas influir en alguien con encanto o persuasi√≥n, puedes gastar 1 de Astucia para obtener un √©xito autom√°tico.",
          "<strong>Tranquilidad bajo presi√≥n:</strong> En cualquier tirada, puedes gastar Astucia para mantener la calma y a√±adir +1d a tu reserva de dados."
        ],
        subclases: {
          periodista: {
            nombre: "Periodista",
            habilidades: [
              "<strong>Acceso a informaci√≥n privilegiada:</strong> Una vez por asignaci√≥n, puedes obtener informaci√≥n confidencial de una fuente de contacto.",
              "<strong>Libro abierto:</strong> Cuando intentas conectar con alguien a trav√©s de una historia personal, obtienes ventaja en la tirada.",
              "<strong>Detector de mentiras:</strong> Cuando haces una tirada de Leer a alguien, puedes gastar 1 Intuici√≥n para saber si te est√°n mintiendo con certeza.",
              "<strong>Conferencia de prensa:</strong> Puedes gastar 1 Astucia para dirigirte a una multitud y controlar la narrativa de una situaci√≥n.",
              "<strong>En las trincheras:</strong> Has hecho suficientes trabajos peligrosos para saber cu√°ndo algo va mal. Obtienes +1d a cualquier tirada para detectar peligro.",
              "<strong>Bien Investigado:</strong> Puedes gastar 1 Intuici√≥n para recordar un detalle relevante sobre el tema actual de investigaci√≥n."
            ],
            iluminacion: "Recoger declaraciones / Cazar una pista / Decir la verdad al poder"
          },
          mago: {
            nombre: "Mago",
            habilidades: [
              "<strong>Despiste:</strong> Cuando usas tus palabras o acciones para distraer a otros, puedes gastar 1 Astucia para que ignoren completamente un evento que acaba de ocurrir.",
              "<strong>Artista del Escape:</strong> Gasta 1 Nervio para escapar autom√°ticamente de cualquier restricci√≥n f√≠sica o situaci√≥n de confinamiento.",
              "<strong>Patr√≥n Practicado:</strong> Has ensayado durante mucho tiempo movimientos precisos. Obtienes +1d a tiradas de prestidigitaci√≥n o movimientos delicados.",
              "<strong>Ojo Asombroso:</strong> Puedes gastar 1 de Intuici√≥n para hacer una pregunta al GM sobre c√≥mo se realiz√≥ un truco o ilusi√≥n que acabas de presenciar.",
              "<strong>Florecimiento:</strong> Sabes c√≥mo cubrir tus errores con estilo. Cuando fallas una tirada, puedes gastar 1 Astucia para convertir el fallo en un √©xito menor.",
              "<strong>El prestigio:</strong> Tu magia suele ser humo y espejos, pero a veces... a veces es real. Una vez por misi√≥n, puedes declarar que un efecto m√°gico que realizas es real."
            ],
            iluminacion: "Realizar un truco / Descubrir una artima√±a / Buscar la magia real"
          }
        }
      },
      musculo: {
        nombre: "M√öSCULO",
        habilidades: [
          "<strong>Conozco a un tipo:</strong> Una vez por misi√≥n, puedes llamar a un contacto que te ayude en una situaci√≥n violenta o de intimidaci√≥n.",
          "<strong>Pu√±os de hierro:</strong> Tus golpes tienen m√°s fuerza. Cuando infliges da√±o en combate cuerpo a cuerpo, a√±ade +1 al resultado.",
          "<strong>Presi√≥n imparable:</strong> Puedes forzar la situaci√≥n a tu favor. Gasta 1 Nervio para superar autom√°ticamente un desaf√≠o f√≠sico."
        ],
        subclases: {
          explorador: {
            nombre: "Explorador",
            habilidades: [
              "<strong>Vista aguda:</strong> Puedes detectar detalles a distancia. Obtienes +1d a tiradas de percepci√≥n visual.",
              "<strong>Rastrear:</strong> Puedes seguir huellas y rastros con gran eficiencia. Obtienes ventaja en tiradas de seguimiento.",
              "<strong>Supervivencia:</strong> Te adaptas al entorno hostil. Sabes encontrar comida, refugio y rutas seguras en cualquier ambiente natural."
            ],
            iluminacion: "Descubrir un camino / Rastrear una amenaza / Sobrevivir lo imposible"
          },
          soldado: {
            nombre: "Soldado",
            habilidades: [
              "<strong>T√°ctica de combate:</strong> Puedes coordinar ataques con aliados. Cuando dirijas un grupo en combate, todos obtienen +1d a sus tiradas de ataque.",
              "<strong>Disciplina:</strong> Eres inmune al miedo y a efectos que busquen intimidarte o controlar tu mente.",
              "<strong>Entrenamiento militar:</strong> Manejas armas con precisi√≥n. Obtienes +1d a tiradas de ataque con armas de fuego o cuerpo a cuerpo."
            ],
            iluminacion: "Proteger a un aliado / Ganar una pelea / Seguir una orden peligrosa"
          }
        }
      },
      erudito: {
        nombre: "ERUDITO",
        habilidades: [
          "<strong>Archivo mental:</strong> Puedes recordar detalles oscuros sobre casi cualquier tema. Gasta 1 Intuici√≥n para conocer un dato relevante.",
          "<strong>Analizar:</strong> Puedes deducir patrones y conexiones. Obtienes +1d a tiradas de investigaci√≥n o deducci√≥n.",
          "<strong>Teor√≠a √∫til:</strong> Puedes aplicar conocimientos en la pr√°ctica. Cuando uses conocimiento acad√©mico para resolver un problema, obtienes ventaja."
        ],
        subclases: {
          doctor: {
            nombre: "Doctor",
            habilidades: [
              "<strong>Curaci√≥n:</strong> Puedes tratar heridas. Una vez por escena, puedes estabilizar a un personaje herido o restaurar 1 punto de Resistencia.",
              "<strong>Diagn√≥stico preciso:</strong> Identificas enfermedades y condiciones m√©dicas con gran precisi√≥n. Obtienes ventaja en tiradas m√©dicas.",
              "<strong>Botiqu√≠n de campo:</strong> Puedes usar equipo m√©dico eficientemente. Tus tratamientos son un 50% m√°s efectivos con suministros b√°sicos."
            ],
            iluminacion: "Salvar una vida / Hacer un diagn√≥stico / Aplicar un tratamiento innovador"
          },
          profesor: {
            nombre: "Profesor",
            habilidades: [
              "<strong>Clase magistral:</strong> Puedes ense√±ar r√°pidamente. Cuando instruyes a otros, aprenden en la mitad del tiempo normal.",
              "<strong>Persuasi√≥n acad√©mica:</strong> Usas argumentos l√≥gicos. Obtienes +1d cuando intentas convencer a otros con razonamiento.",
              "<strong>Teor√≠a arcana:</strong> Puedes explicar lo inexplicable. Tienes conocimientos b√°sicos sobre fen√≥menos sobrenaturales."
            ],
            iluminacion: "Ense√±ar algo vital / Encontrar conocimiento perdido / Inspirar a otro personaje"
          }
        }
      },
      escurridizo: {
        nombre: "ESCURRIDIZO",
        habilidades: [
          "<strong>Desaparecer:</strong> Puedes desaparecer r√°pidamente de la vista. Gasta 1 Nervio para esconderte autom√°ticamente.",
          "<strong>Silencio absoluto:</strong> Tus pasos son imperceptibles. Obtienes +1d a tiradas de sigilo.",
          "<strong>Movimiento √°gil:</strong> Te desplazas con gran facilidad. Obtienes ventaja en tiradas de acrobacias o escalada."
        ],
        subclases: {
          ladr√≥n: {
            nombre: "Ladr√≥n",
            habilidades: [
              "<strong>Manos ligeras:</strong> Robas sin ser detectado. Obtienes +1d a tiradas de hurto o pickpocketing.",
              "<strong>Oportunista:</strong> Aprovechas el caos a tu favor. En situaciones de distracci√≥n, obtienes ventaja en acciones furtivas.",
              "<strong>Trucos del oficio:</strong> Tienes herramientas para abrir casi cualquier cosa. Obtienes +1d a tiradas de lockpicking o desactivaci√≥n de trampas."
            ],
            iluminacion: "Robar algo valioso / Escapar sin ser visto / Revelar un secreto guardado"
          },
          espia: {
            nombre: "Esp√≠a",
            habilidades: [
              "<strong>Identidad falsa:</strong> Adoptas roles convincentes. Obtienes +1d a tiradas de disfraz o interpretaci√≥n.",
              "<strong>Recoger rumores:</strong> Obtienes informaci√≥n √∫til en poco tiempo. En entornos sociales, aprendes secretos r√°pidamente.",
              "<strong>Red de contactos:</strong> Conoces personas en los lugares adecuados. Puedes encontrar un contacto √∫til en casi cualquier ubicaci√≥n."
            ],
            iluminacion: "Descubrir un complot / Obtener informaci√≥n clave / Ganarte la confianza de un enemigo"
          }
        }
      },
      raro: {
        nombre: "RARO",
        habilidades: [
          "<strong>Sensibilidad:</strong> Percibes lo que otros no pueden. Puedes detectar presencia sobrenatural sin necesidad de tirada.",
          "<strong>Intuici√≥n inexplicable:</strong> Sabes cosas sin saber por qu√©. Una vez por sesi√≥n, el GM te dar√° informaci√≥n que tu personaje no deber√≠a conocer.",
          "<strong>Toque extra√±o:</strong> Puedes alterar la realidad con tu presencia. Gasta 1 de cualquier atributo para causar un efecto menor pero sobrenatural."
        ],
        subclases: {
          vidente: {
            nombre: "Vidente",
            habilidades: [
              "<strong>Premonici√≥n:</strong> Intuyes el peligro antes de que ocurra. Obtienes +1d a tiradas de percepci√≥n de amenazas.",
              "<strong>Lectura de auras:</strong> Ves las emociones de los dem√°s. Puedes determinar el estado emocional de una persona con solo mirarla.",
              "<strong>Visi√≥n del m√°s all√°:</strong> Percibes esp√≠ritus o entidades ocultas. Puedes comunicarte con lo sobrenatural en ciertas condiciones."
            ],
            iluminacion: "Tener una visi√≥n √∫til / Contactar con lo oculto / Advertir de un peligro inminente"
          },
          mutante: {
            nombre: "Mutante",
            habilidades: [
              "<strong>Alteraci√≥n corporal:</strong> Puedes cambiar partes de tu cuerpo. Gasta 1 Nervio para adaptar temporalmente tu fisiolog√≠a a una necesidad.",
              "<strong>Regeneraci√≥n:</strong> Sanas de forma acelerada. Recuperas 1 punto de Resistencia adicional por descanso.",
              "<strong>Sentidos agudizados:</strong> Ves, oyes o hueles mucho mejor que un humano com√∫n. Elige un sentido que es excepcionalmente agudo."
            ],
            iluminacion: "Usar una mutaci√≥n con √©xito / Ser aceptado pese a tu diferencia / Aprender sobre tu origen"
          }
        }
      }
    };

    const equipamientoLista = [
      "Frasco de contenci√≥n de Sangrado", "Arma de mano", "Detector de Sangrado", "Atomizador", "Equipo de primeros auxilios",
      "Binoculares", "Guia de la ciudad", "Brujula", "Palanca", "Dictafono", "Kit de camuflaje", "Reloj de Bolsillo",
      "Material inflamable", "Linterna", "Silex y acero", "Linterna de gas", "Sabueso leal", "Mechero", "Lupa",
      "Mapa", "Tarjeta de Membresia", "Camara de video", "Hilo y aguja", "Candado y llave", "Microscopio de bolsillo",
      "Herramientas de precision", "Cuerda", "Cizalla", "Silvato", "Mas objetos especiales - Pagina 190 del libro (CONSULTAR GM)"
    ];

    // Variables para almacenar datos
    let currentClase = null;
    let currentSubclase = null;

    // Inicializaci√≥n al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      const contenedor = document.getElementById("equipamiento");
      equipamientoLista.forEach(item => {
        const div = document.createElement("div");
        div.className = "checkbox-container";
        div.innerHTML = `
          <input type="checkbox" id="eq-${item.replace(/\s+/g, '-')}" value="${item}" onchange="updateEquipamiento(event)">
          <label for="eq-${item.replace(/\s+/g, '-')}" class="cursor-pointer">${item}</label>
        `;
        contenedor.appendChild(div);
      });

      // Configurar evento para el selector de rol
      document.getElementById("rol").addEventListener("change", function() {
        const clase = this.value;
        currentClase = clase;
        const datos = clases[clase];
        const contenido = document.getElementById("contenido-clases");

        if (!datos) return;

        let html = `<h3 class="text-xl mb-3 text-amber-200">${datos.nombre}</h3>`;
        html += `<p class="mb-3 italic">Tus habilidades principales son:</p><ul class="list-disc pl-5 mb-4">`;
        datos.habilidades.forEach(h => html += `<li class="mb-1">${h}</li>`);
        html += `</ul>`;
        html += `<label for="subclase-select" class="block font-semibold mt-4 mb-2 text-amber-200">Subclase:</label>`;
        html += `<select id="subclase-select" class="rounded-sm" onchange="updateSubclasePreview()">`;
        Object.keys(datos.subclases).forEach(s => {
          html += `<option value="${s}">${datos.subclases[s].nombre}</option>`;
        });
        html += `</select>`;
        html += `<div id="subclase-contenido" class="mt-4"></div>`;

        contenido.innerHTML = html;

        document.getElementById("subclase-select").addEventListener("change", function() {
          mostrarSubclase(clase, this.value);
        });

        const primera = Object.keys(datos.subclases)[0];
        mostrarSubclase(clase, primera);
        updateSubclasePreview();
        updateHabilidadesPreview();
      });
    });

    function mostrarSubclase(claveClase, claveSubclase) {
      currentSubclase = claveSubclase;
      const sub = clases[claveClase].subclases[claveSubclase];
      let html = `<h4 class="font-bold mt-3 mb-2 text-amber-200">${sub.nombre}</h4><ul class="list-disc pl-5 mb-3">`;
      sub.habilidades.forEach(h => html += `<li class="mb-1">${h}</li>`);
      html += `</ul><p class="mt-3 italic"><strong class="text-amber-200">Claves de Iluminaci√≥n:</strong> ${sub.iluminacion}</p>`;
      document.getElementById("subclase-contenido").innerHTML = html;
      updateHabilidadesPreview();
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.getElementById('character-image');
          const placeholder = document.getElementById('image-placeholder');
          img.src = e.target.result;
          img.style.display = 'block';
          placeholder.style.display = 'none';
          
          // Actualizar vista previa
          const previewImg = document.getElementById('preview-character-image');
          const previewPlaceholder = document.getElementById('preview-image-placeholder');
          previewImg.src = e.target.result;
          previewImg.style.display = 'block';
          previewPlaceholder.style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    }

     function updatePreview() {
      document.getElementById('preview-nombre').textContent = document.getElementById('nombre').value || "No especificado";
      document.getElementById('preview-circulo').textContent = document.getElementById('circulo').value || "No especificado";
      document.getElementById('preview-estilo').textContent = document.getElementById('estilo').value || "No especificado";
      document.getElementById('preview-catalizador').textContent = document.getElementById('catalizador').value || "No especificado";
      document.getElementById('preview-cuestion').textContent = document.getElementById('cuestion').value || "No especificado";
      document.getElementById('preview-rol').textContent = document.getElementById('rol').options[document.getElementById('rol').selectedIndex].text || "No seleccionado";
      updateSubclasePreview();
    }

    function updateSubclasePreview() {
      const rolSelect = document.getElementById('rol');
      const subclaseSelect = document.getElementById('subclase-select');
      
      if (rolSelect.value && subclaseSelect) {
        document.getElementById('preview-subclase').textContent = subclaseSelect.options[subclaseSelect.selectedIndex].text;
      } else {
        document.getElementById('preview-subclase').textContent = 'No seleccionada';
      }
    }

    function updateEquipamiento(event) {
      const checkboxes = document.querySelectorAll('#equipamiento input[type="checkbox"]');
      const selected = Array.from(checkboxes).filter(cb => cb.checked);
      if (selected.length > 6) {
        alert('Solo puedes seleccionar hasta 6 objetos.');
        event.target.checked = false;
        return;
      }
      document.getElementById('preview-equipamiento').textContent = selected.length > 0 
        ? selected.map(cb => cb.value).join(', ') 
        : "No seleccionado";
    }

    function mostrarDetallesRol() {
      const rol = document.getElementById('rol').value;
      const detalles = document.getElementById('detalle-rol');
      if (rol !== "") {
        detalles.classList.remove("hidden");
      } else {
        detalles.classList.add("hidden");
      }
    }

    function validarFormulario(event) {
      const obligatorios = ['nombre', 'circulo', 'estilo', 'catalizador', 'cuestion', 'rol'];
      for (let id of obligatorios) {
        const campo = document.getElementById(id);
        if (!campo.value.trim()) {
          alert('Por favor, completa todos los campos obligatorios.');
          campo.focus();
          event.preventDefault();
          return false;
        }
      }
      
      // Verificar que se haya seleccionado una subclase
      const rol = document.getElementById('rol').value;
      if (rol && !document.getElementById('subclase-select')) {
        alert('Por favor, selecciona una subclase para tu rol.');
        event.preventDefault();
        return false;
      }
      
      return true;
    }
	function openDiceModal() {
    document.getElementById('diceModal').classList.remove('hidden');
  }

  function closeDiceModal() {
    document.getElementById('diceModal').classList.add('hidden');
    document.getElementById('dice-results').innerHTML = '';
    document.getElementById('dice-final').innerHTML = '';
  }

  function rollCandelaDice() {
    document.getElementById('dice-sound').play();
    const emojiMap = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
    const greenCount = parseInt(document.getElementById('greenDice').value) || 0;
    const goldCount = parseInt(document.getElementById('goldDice').value) || 0;

    const greenResults = Array.from({ length: greenCount }, () => ({ value: Math.ceil(Math.random() * 6), type: 'green' }));
    const goldResults = Array.from({ length: goldCount }, () => ({ value: Math.ceil(Math.random() * 6), type: 'gold' }));
    const all = [...greenResults, ...goldResults];

    const greenHTML = greenResults.map(d => `<span class="text-green-400 text-2xl">${emojiMap[d.value - 1]}</span>`).join(' ');
    const goldHTML = goldResults.map(d => `<span class="text-yellow-300 text-2xl">${emojiMap[d.value - 1]}</span>`).join(' ');

    document.getElementById('dice-results').innerHTML = `
      ${greenCount ? `<div><strong>Verdes:</strong> ${greenHTML}</div>` : ''}
      ${goldCount ? `<div><strong>Guilded:</strong> ${goldHTML}</div>` : ''}
    `;

    const highest = Math.max(...all.map(d => d.value));
    const fromGuilded = all.some(d => d.value === highest && d.type === 'gold');

    document.getElementById('dice-final').innerHTML = fromGuilded
      ? `<span class="text-yellow-400">‚ú® Resultado Final (Guilded): ${emojiMap[highest - 1]} ‚Äî ¬°Ganas 1 punto de Iluminaci√≥n!</span>`
      : `<span class="text-green-300">Resultado Final: ${emojiMap[highest - 1]}</span>`;
  }
  </script>


</body>
</html>